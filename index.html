<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clean Drive RPDA — Vehicle Emission Monitoring (IoT)</title>
  <meta name="description" content="Clean Drive RPDA: roadside vehicle emission monitoring with ESP32-CAM, MQ sensors, SD logging and Adafruit IO integration." />

  <style>
    
    :root{
      --accent:gray;
      --muted:white;
      
      
      --maxw:980px;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
  
   
    
    h1{margin:0;font-size:22px}
    p.lead{color:white;margin:4px 0 8px}
    nav.toc{padding:12px;margin:14px 0}
    nav.toc a{display:inline-block;margin:6px 8px;color:darkblue;text-decoration:none}
  
    
    
    
    .code{background:#0f1724;color:#e6eef8;padding:12px;border-radius:8px;overflow:auto;font-family:monospace;font-size:13px}
    .flex-row{display:flex;gap:12px;flex-wrap:wrap}
    .btn{background:var(--accent);color:#f0ededd8;padding:8px 12px;border-radius:8px;text-decoration:none}
    
   .for{color:white;}
    
    .meta{font-size:13px;color:white}
    
    .kicker{font-size:18px;color:darkslateblue;margin-bottom:8px}
  </style>

<div style="height:60%; text-align:center; padding:40px 20px; 
     background-image:url('urban-highway.jpg'); 
     background-size:cover; 
     background-repeat:no-repeat; 
     background-position:center; 
     position:relative;">
  
    <div style="height:60%; text-align:center; padding:40px 20px; background-image:url('road.png'); background-size:cover; background-repeat:no-repeat; background-position:center; position:relative;">
        <div style="position:absolute; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5);"></div>
        <div style="position:relative; z-index:1;">
            <h1 style="color:aliceblue; line-height:1.4;">VEHICLE EMISSION MONITORING INTEGRATED WITH IOT <br>(Clean drive RPDA)</h1>
           <p class="lead">Real-time roadside emission detection using ESP32-CAM, MQ sensors, SD logging and cloud publishing (Adafruit IO).</p>
       
        </div>
    </div>
        
<div>

    <nav class="toc card" aria-label="Table of contents" >
      <strong>Contents</strong>
      <div style="margin-top:8px">
        <a href="#abstract">Abstract</a> •
        <a href="#implementation">Implementation</a> •
        <a href="#components">Components</a> •
        <a href="#Diagram">System Diagram</a> •
        <a href="#code">Code</a> •
        <a href="#future">Future Work</a>
         <div style="padding-left: 80%;">
          <h3>Quick links</h3>
          <div class="flex-row" style="margin-top:8px">
            <a class="btn" href="#code">Firmware</a>
            <a class="btn" href="#Diagram">Diagram</a>
          </div>
      </div>
      </nav>
      <div><h1  style="color:aliceblue; text-align:center; "><u>Project owners</u></h1></div>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(50px,1fr)); gap:10px; padding:10px; max-width:900px; margin:20px auto;padding: left 10px;">
      
      <div style="background-color:#272525; border-radius:5px; padding:10px; text-align:center; padding-left: 1%;">
              
          <h1 style="color:white;">Emmelyne .I.Gihozo</h1>
            <img src="emmy.jpg" alt="" style="width:200px; border: radius 10px; margin-top:10px;">
             <h1> <a href="Emily portfolio.html" style="display:inline-block; padding:10px 20px; background-color:gray; color:#fff; border-radius:10px; text-decoration:none; margin-top:10px;">more about</a><h1>
        </div>
        <div style="background-color:#2e2a2a; border-radius:10px; padding:10px; text-align:center;">
            <h1 style="color:white;" >John Niyonizeye</h1>
            <img src="rap.png" alt="" style="width:200px; border-radius:10%; margin-top:10px;">
             <h1> <a href="rape portif.html" style="display:inline-block; padding:10px 20px; background-color:gray; color:#fff; border-radius:10px; text-decoration:none; margin-top:10px;">more about </a></h1>
        </div>
      </div>

          
        </div>
        
</div>
</head>
    <body style="margin-left:20; font-family:Arial, sans-serif; background-color:rgb(202, 175, 175); color:black; ">
      
              <div style="height: 30%; text-align: justify; padding:10px;" >
         <h1 >Project Introduction</h1>
<p style="color:white ;">The Vehicle Emission Monitoring System using IoT (Clean Drive RPDA) is an innovative project designed to detect and monitor harmful vehicle emissions in real time. <br> As environmental pollution from vehicles continues to rise, this system provides a smart and automated approach to identify vehicles emitting gases beyond the acceptable threshold. <br> By integrating IoT technology, infrared sensors, and an ESP32-CAM module, the system captures both emission data and vehicle plate images for accurate monitoring. <br> Data is transmitted to an online IoT platform for visualization and analysis, enabling authorities to track pollution sources and take necessary actions. <br>This project demonstrates how technology can be leveraged to support cleaner roads and promote environmental sustainability.</p>
   
    
      <div>
       
        <section id="abstract" >
          <div class="kicker">Abstract</div>
          <h2>Project overview</h2>
          <p class="for">
            <strong >Clean Drive RPDA</strong> is a roadside emission monitoring prototype that detects and logs pollutants (CO, NOx, CO₂ and general air quality indicators) from passing vehicles.
            <br>The device uses an ESP32-CAM for image capture (license plate evidence) and MQ-series gas sensors for air-quality readings. <br>
            Data is logged locally to an SD card and published to Adafruit IO for remote monitoring and analysis.
          </p>
          <p><strong>Primary goals:</strong> 
            <ul class="for">
           <li>Identify high-emission vehicles in real time.<br>
            <li>Create an auditable dataset for local authorities and researchers .</li>
            <li>Demonstrate a low-cost IoT monitoring node.</li>
            </ul>
          </p>
        </section>

        <div style="padding: 10px;">
        <section id="implementation" >
          <div class="kicker">Implementation summary</div>
          <h2>Working principle</h2>
          <p class="for">
            When the IR sensor detects a passing vehicle, the ESP32-CAM wakes the gas sensors,<br> reads the concentrations, and converts sensor raw readings to human-friendly units.
            If pollutant values exceed thresholds, an alarm (buzzer) is triggered,<br> a photo is captured and saved to the SD card, and the readings (with timestamp and device id) are published to Adafruit IO. <br> 
            The photo upload to a remote endpoint is attempted for license-plate recognition if available.
          </p>

          <h3 style="margin-top:12px" >Implementation stages</h3>
          <p>
            <ul class="for">
            <ul class="for">
           <li> Hardware prototyping & sensor selection <br></li>
           <img src="" alt="">
           <li> Arduino / ESP32 firmware development <br></li>
           <img src="loop.png" alt=" IDE images" style="width:25cm;" >
           <li> Local SD logging, image capture <br></li>
           <img src="" alt="implementation image">
           <li> Cloud integration  <br></li>
           <img src="dash.png" alt=" adafruitphoto" style="width:25cm;">
           <li> Field testing and calibration</li>
           <img src="" alt="cncb">
            </ul>
          </p>
        </section>
        </div>
        <div style="margin-top:12px">
            <h4 style="margin:0">Project images</h4>
            <p class="meta" style="margin:6px 0 12px"></p>
           
            <img class="image" src="dash.png" alt="Hardware setup " style="width:10cm;" />
            <img class="image" src="empty-highway-cityscape-chongqingchina-260nw-758655235.webp" alt="Deployment photo " style=" width:10cm;"/>
          </div>
          <section id="components">
    <div style="border-radius:20px; background-color:#61666b; padding:20px; margin:20px auto; max-width:1000px;">
        <h3 style="color:aliceblue;"> Components:</h3>
        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; padding:20px;">
            <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1>INFRARED SENSOR</h1>
                <p>An infrared (IR) sensor is an optoelectronic device that detects and measures infrared radiation, a form of electromagnetic energy with wavelengths longer than visible light</p>
                <img src="INFRARED.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
            <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1>MQ-7</h1>
                <p>The MQ-7 is a semiconductor gas sensor module designed to detect carbon monoxide (CO) in the air, measuring concentrations between 20 and 2000 ppm with high sensitivity and a fast response time.</p>
                <img src="MQ7.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
            <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1>ESP32 CAM</h1>
                <p>The ESP32-CAM is a compact, low-cost development board featuring an ESP32-S System-on-Chip and an integrated 2-megapixel OV2640 camera sensor, enabling wireless image and video streaming via Wi-Fi.</p>
                <img src="ESP32 CAM.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
            <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1>BUZZER</h1>
                <p>A buzzer is an audio signaling device that creates a buzzing or beeping sound when an electrical current is applied.</p>
                <img src="BUZZER.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
            <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1>MQ135 SENSOR</h1>
                <p>The MQ-135 is a gas sensor module used for air quality monitoring, capable of detecting a wide range of harmful gases including ammonia (NH3), nitrogen oxides (NOx), alcohol, benzene, smoke, and carbon dioxide (CO2)</p>
                <img src="MQ135.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
                <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1> 5VDC POWER SUPPLY</h1>
                <p>A 5V power supply is an electrical device that converts a higher AC voltage (like from a wall outlet) into a stable, regulated 5V DC output. </p>
                <img src="5V power supply.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
                  <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1> SD CARD</h1>
                <p>An SD card is a compact, removable flash memory card used for storing and transferring digital data. </p>
                <img src="SD CARD.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
                  <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1> SOLDERING IRON</h1>
                <p>A soldering iron is a hand-held tool with a heated metal tip used to melt solder, creating a permanent bond between metal workpieces. </p>
                <img src="solder.png" alt="" style="width:80%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
   <div style="background-color:#b6b5b5; border-radius:20px; padding:20px; text-align:center; color:#000;">
                <h1> CONNECTING WIRE</h1>
                <p>
                  Connecting wires are used to create electrical connections between two points, often involving joining wires together using methods like wire nuts, screw terminals, or crimping </p>
                <img src="WIRE.png" alt="" style="width:100%; max-width:200px; border-radius:10px; margin-top:10px;">
            </div>
             </div>
        </div>
    </div>
    </section>
<section id="Diagram">
   <div id="Diagram"style="border-radius:20px; background-color:#f1f4f8; padding-left:15%; margin:20px auto; max-width:1000px;">
  
              
        <h3 class="kicker">Electronic design and diagrams:</h3>
        <h2>ELECTRONIC DESIGNS IMAGES:</h2>
        <p style="color:darkblue">Here’s a screenshot of circuit diagram and flow chart </p>
        <img src="PROTEUS SIMULATION.png" alt="" style="max-width:40%; border-radius:10px;">
    <img src="FLOW CHART.png"  alt="" style="max-width:30%; border-radius:10px;">
            </div>
      </div>
</section>
      

       <section id="code">
        <div style="padding-left: 15%;padding-right: 15%;"  class="for">
          <div class="kicker">Firmware </div>
          <h2>Core firmware</h2>
          <p>Below is the cleaned sketch used for the ESP32-CAM node. Update the placeholders before uploading.</p>

          <div class="code" style="white-space:pre-wrap;font-size:12px;">
// clean_drive_rpda.ino
// Replace SSID, PASSWORD, AIO_USERNAME, AIO_KEY, and apiKey with your credentials.

#include &lt;WiFi.h&gt;
#include "Adafruit_MQTT.h"
#include "Adafruit_MQTT_Client.h"
#include &lt;WiFiClientSecure.h&gt;
#include "esp_camera.h"
#include &lt;SPI.h&gt;
#include &lt;SD.h&gt;

const char* ssid = "YOUR_WIFI_SSID";
const char* password = "YOUR_WIFI_PASSWORD";

#define AIO_SERVER      "io.adafruit.com"
#define AIO_SERVERPORT  1883
#define AIO_USERNAME    "YOUR_ADAFRUIT_USERNAME"
#define AIO_KEY         "YOUR_ADAFRUIT_KEY"

String serverName = "www.circuitdigest.cloud"; // or your upload endpoint
String serverPath = "/readnumberplate";
const int serverPort = 443;
String apiKey = "YOUR_API_KEY";

#define FLASHLIGHT_PIN 4
#define SD_CS_PIN 8
#define IR_SENSOR_PIN 2
#define CO_SENSOR_PIN 34
#define NOX_SENSOR_PIN 35
#define BUZZER_PIN 14

int coThreshold = 200;   // tune after calibration
int noxThreshold = 100;  // tune after calibration

WiFiClientSecure client;
Adafruit_MQTT_Client mqtt(&client, AIO_SERVER, AIO_SERVERPORT, AIO_USERNAME, AIO_KEY);
Adafruit_MQTT_Publish coFeed = Adafruit_MQTT_Publish(&mqtt, String(AIO_USERNAME)+"/feeds/Covalue");
Adafruit_MQTT_Publish noxFeed = Adafruit_MQTT_Publish(&mqtt, String(AIO_USERNAME)+"/feeds/Noxvalue");

#define PWDN_GPIO_NUM 32
#define RESET_GPIO_NUM -1
#define XCLK_GPIO_NUM 0
#define SIOD_GPIO_NUM 26
#define SIOC_GPIO_NUM 27
#define Y9_GPIO_NUM 35
#define Y8_GPIO_NUM 34
#define Y7_GPIO_NUM 39
#define Y6_GPIO_NUM 36
#define Y5_GPIO_NUM 21
#define Y4_GPIO_NUM 19
#define Y3_GPIO_NUM 18
#define Y2_GPIO_NUM 5
#define VSYNC_GPIO_NUM 25
#define HREF_GPIO_NUM 23
#define PCLK_GPIO_NUM 22

void MQTT_connect() {
  if (mqtt.connected()) return;
  int8_t ret;
  uint8_t retries = 3;
  while ((ret = mqtt.connect()) != 0) {
    mqtt.disconnect();
    delay(2000);
    retries--;
    if (retries == 0) return;
  }
}

int sendPhoto() {
  camera_fb_t* fb = esp_camera_fb_get();
  if (!fb) return -1;
  client.setInsecure();
  if (!client.connect(serverName.c_str(), serverPort)) {
    esp_camera_fb_return(fb);
    return -2;
  }
  String filename = apiKey + ".jpeg";
  String head = "--Boundary\r\nContent-Disposition: form-data; name=\"imageFile\"; filename=\"" + filename + "\"\r\nContent-Type: image/jpeg\r\n\r\n";
  String tail = "\r\n--Boundary--\r\n";
  uint32_t imageLen = fb->len;
  uint32_t totalLen = imageLen + head.length() + tail.length();
  client.println("POST " + serverPath + " HTTP/1.1");
  client.println("Host: " + serverName);
  client.println("Content-Length: " + String(totalLen));
  client.println("Content-Type: multipart/form-data; boundary=Boundary");
  client.println("Authorization:" + apiKey);
  client.println();
  client.print(head);
  client.write(fb->buf, fb->len);
  client.print(tail);
  esp_camera_fb_return(fb);
  client.stop();
  return 0;
}

void setup() {
  Serial.begin(115200);
  WRITE_PERI_REG(RTC_CNTL_BROWN_OUT_REG, 0);

  pinMode(FLASHLIGHT_PIN, OUTPUT);
  pinMode(BUZZER_PIN, OUTPUT);
  pinMode(IR_SENSOR_PIN, INPUT);

  if (!SD.begin(SD_CS_PIN)) {
    Serial.println("SD card init failed");
  }

  WiFi.begin(ssid, password);
  Serial.print("Connecting WiFi");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWiFi connected.");

  camera_config_t config;
  config.ledc_channel = LEDC_CHANNEL_0;
  config.ledc_timer = LEDC_TIMER_0;
  config.pin_d0 = Y2_GPIO_NUM;
  config.pin_d1 = Y3_GPIO_NUM;
  config.pin_d2 = Y4_GPIO_NUM;
  config.pin_d3 = Y5_GPIO_NUM;
  config.pin_d4 = Y6_GPIO_NUM;
  config.pin_d5 = Y7_GPIO_NUM;
  config.pin_d6 = Y8_GPIO_NUM;
  config.pin_d7 = Y9_GPIO_NUM;
  config.pin_xclk = XCLK_GPIO_NUM;
  config.pin_pclk = PCLK_GPIO_NUM;
  config.pin_vsync = VSYNC_GPIO_NUM;
  config.pin_href = HREF_GPIO_NUM;
  config.pin_sscb_sda = SIOD_GPIO_NUM;
  config.pin_sscb_scl = SIOC_GPIO_NUM;
  config.pin_pwdn = PWDN_GPIO_NUM;
  config.pin_reset = RESET_GPIO_NUM;
  config.xclk_freq_hz = 20000000;
  config.pixel_format = PIXFORMAT_JPEG;
  config.frame_size = FRAMESIZE_SVGA;
  config.jpeg_quality = 10;
  config.fb_count = 1;
  esp_camera_init(&config);
}

void loop() {
  int vehicleDetected = digitalRead(IR_SENSOR_PIN);
  if (vehicleDetected) {
    int coValue = analogRead(CO_SENSOR_PIN);    // raw ADC
    int noxValue = analogRead(NOX_SENSOR_PIN);
    // map ADC to 0-1000 range (adjust to your sensors' ranges after calibration)
    float co = map(coValue, 0, 4095, 0, 1000);
    float nox = map(noxValue, 0, 4095, 0, 1000);

    Serial.print("CO: "); Serial.print(co);
    Serial.print(" | NOx: "); Serial.println(nox);

    File dataFile = SD.open("/AIR_DATA.txt", FILE_APPEND);
    if (dataFile) {
      dataFile.print(millis());
      dataFile.print(", CO: "); dataFile.print(co);
      dataFile.print(", NOx: "); dataFile.println(nox);
      dataFile.close();
    }

    if (co > coThreshold || nox > noxThreshold) {
      digitalWrite(BUZZER_PIN, HIGH);
      sendPhoto();

      MQTT_connect();
      coFeed.publish(String(co));
      noxFeed.publish(String(nox));
    } else {
      digitalWrite(BUZZER_PIN, LOW);
    }
  }

  delay(1500);
}
          </div>

          <p class="meta" style="margin-top:10px">Notes: tune <code>coThreshold</code> and <code>noxThreshold</code> after calibration. ESP32 ADC returns 0–4095 by default; adjust mapping/calibration for your sensor and board.</p>
        </div>
</section> 
        <div style="padding: 5%;">
        <section style="padding-left: 15%;" id="future" class="card">
          <div class="kicker">Future improvements</div>
          <ul class="for">
            <li>Replace MQ sensors with calibrated electrochemical sensors for better accuracy.</li>
            <li>Add GPS for geotagging each reading.</li>
          
            <li>Power the node with a small solar + battery system for autonomous roadside deployment.</li>
            <li>Introduce data privacy and retention policy if storing images of vehicles.</li>
          </ul>
        </section>
      </div>
</div>
      
</body>

    
<footer style="font-size: smaller ; display:inline-flex; padding-left: 35% ;" class="footer">
    <p style="color: #fff;"> © 2025 Clean Drive RPDA — Emmelyne I. Gihozo &amp; John Niyonizeye. For collaboration:https://github.com/Emilycabelano/drive" .
    </p>
  </footer>
      
  </div>
</body>
</html>
